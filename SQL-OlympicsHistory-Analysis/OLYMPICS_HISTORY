/*DROP TABLE IF EXISTS OLYMPICS_HISTORY;
CREATE TABLE IF NOT EXISTS OLYMPICS_HISTORY
(
	id INT,
	name VARCHAR,
	sex VARCHAR,
	age VARCHAR,
	height VARCHAR,
	weight VARCHAR,
	team VARCHAR,
	noc VARCHAR,
	games VARCHAR,
	year INT,
	season VARCHAR,
	city VARCHAR,
	sport VARCHAR,
	event VARCHAR,
	medal VARCHAR
);

DROP TABLE IF EXISTS NOC_REGIONS;
CREATE TABLE IF NOT EXISTS NOC_REGIONS
(
	NOC VARCHAR,
	regions VARCHAR,
	notes VARCHAR
);*/

-------------------------------------------------------------------------

UPDATE OLYMPICS_HISTORY
SET MEDAL = NULL
WHERE MEDAL = 'NA';

--SELECT * FROM OLYMPICS_HISTORY;

--QUERY 1: How many olympics games have been held?--

SELECT COUNT(DISTINCT GAMES) FROM OLYMPICS_HISTORY;

--QUERY 2: List down all Olympics games held so far.--

SELECT YEAR, SEASON, CITY FROM OLYMPICS_HISTORY
ORDER BY YEAR ASC;

--QUERY 3: How many athlete total?

SELECT COUNT(DISTINCT NAME) FROM OLYMPICS_HISTORY;

--QUERY 4: HOW MANY OF THEM WON MEDAL?

SELECT COUNT(DISTINCT NAME) FROM OLYMPICS_HISTORY WHERE MEDAL IS NOT NULL;

--QUERY 5: find the top 3 countries in terms of the total number of medals

SELECT TEAM, COUNT(MEDAL) AS MEDAL_WON FROM OLYMPICS_HISTORY WHERE MEDAL IS NOT NULL
GROUP BY TEAM
ORDER BY MEDAL_WON DESC
LIMIT 3;

--QUERY 6: average age of female and male athletes who won a medal.
--SOME DATA IN AGE COLUMN IS 'NA' THEREFORE HAD TO USE SUBQUERY
SELECT SEX, CEIL(AVG(AGE::INT)) AS AVERAGE_AGE FROM (SELECT SEX,age, MEDAL FROM OLYMPICS_HISTORY
where age != 'NA') AS X
GROUP BY SEX;

--QUERY 7:  Identify the sport which was played in all summer olympics.

--SELECT SPORT, GAMES FROM OLYMPICS_HISTORY WHERE SEASON = 'Summer' ORDER BY GAMES
--STEP 1: FIND TOTAL NUMBER OF SUMMER OLYMPICS GAMES
--SELECT COUNT(DISTINCT GAMES) FROM OLYMPICS_HISTORY WHERE SEASON = 'Summer';
--STEP 2: FIND FOR EACH SPORT, HOW MANY GAMES WERE THEY PLAYED IN SUMMER?
--SELECT DISTINCT SPORT, GAMES FROM OLYMPICS_HISTORY WHERE SEASON = 'Summer' ORDER BY GAMES

WITH T1 AS 
	(SELECT COUNT(DISTINCT GAMES) AS TOTAL_SUMMER_GAMES FROM OLYMPICS_HISTORY WHERE SEASON = 'Summer'),
	T2 AS
	(SELECT DISTINCT SPORT, GAMES FROM OLYMPICS_HISTORY WHERE SEASON = 'Summer' ORDER BY GAMES),
	T3 AS
	(SELECT SPORT, COUNT(GAMES) AS NO_OF_GAMES FROM T2 GROUP BY SPORT)
SELECT * FROM T3 JOIN T1 ON T1.TOTAL_SUMMER_GAMES = T3.NO_OF_GAMES;

--QUERY 8: Fetch the top 5 athletes who have won the most gold medals.
WITH T1 AS 
		(SELECT NAME, count(*) AS TOTAL_MEDAL
		FROM OLYMPICS_HISTORY WHERE MEDAL = 'Gold'
		GROUP BY NAME
		ORDER BY COUNT(*) DESC),
	T2 AS
		(SELECT *, DENSE_RANK() OVER (ORDER BY TOTAL_MEDAL DESC) AS rank from T1)
SELECT * FROM T2 WHERE rank <=5;

--QUERY 9: Fetch the top 5 athletes who have won the most medals (gold/silver/bronze).
SELECT NAME, count(*) AS TOTAL_MEDAL
FROM OLYMPICS_HISTORY 
GROUP BY NAME 
ORDER BY COUNT(*) DESC LIMIT 5;

--QUERY 10:Fetch the top 5 most successful countries in olympics. Success is defined by no of medals won

SELECT TEAM, count(*) AS TOTAL_MEDAL
FROM OLYMPICS_HISTORY 
GROUP BY TEAM 
ORDER BY COUNT(*) DESC LIMIT 5;




	
